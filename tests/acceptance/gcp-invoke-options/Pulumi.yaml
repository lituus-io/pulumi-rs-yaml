name: gcp-invoke-options-test
runtime: yaml
description: Test fn::invoke with provider and dependsOn options
config:
  gcp:project:
    value: spacy-muffin-lab-5a292e
  gcp:region:
    value: us-central1
resources:
  explicitProvider:
    type: pulumi:providers:gcp
    properties:
      project: spacy-muffin-lab-5a292e
      region: us-central1
  invokeBucket:
    type: gcp:storage:Bucket
    properties:
      name: invoke-opts-test-bucket
      location: US
      forceDestroy: true
      uniformBucketLevelAccess: true
variables:
  # fn::invoke with explicit provider
  projectInfoWithProvider:
    fn::invoke:
      function: gcp:organizations:getProject
      arguments: {}
      options:
        provider: ${explicitProvider}
  # fn::invoke with dependsOn â€” invoke should wait for bucket
  projectInfoAfterBucket:
    fn::invoke:
      function: gcp:organizations:getProject
      arguments: {}
      options:
        dependsOn:
          - ${invokeBucket}
outputs:
  bucketName: ${invokeBucket.name}
  projectIdViaProvider: ${projectInfoWithProvider.projectId}
  projectIdAfterBucket: ${projectInfoAfterBucket.projectId}
